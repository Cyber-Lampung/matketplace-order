<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Debug File Upload</title>
  </head>
  <body>
    <input type="file" id="input_file_html" />
    <input type="text" placeholder="Masukan Nama Produk" id="nama_produk" />
    <input type="number" placeholder="masukan harga" id="harga_produk" />
    <input
      type="number"
      placeholder="masukan rating produk"
      id="rating_produk"
    />
    <button id="btn_kirim">Kirim File</button>

    <button onclick="getData()">get data produk</button>

    <div id="priview"></div>

    <script>
      const priview = document.getElementById("priview");

      function postData() {
        const btn = document.getElementById("btn_kirim");
        const input = document.getElementById("input_file_html");

        btn.addEventListener("click", async (e) => {
          e.preventDefault();

          if (input.files.length === 0) {
            alert("Silakan pilih file terlebih dahulu!");
            return;
          }

          // 1. Gunakan FormData
          const dataKirim = new FormData();

          const dataProduk = {
            id: 1,
            name_produk: "adidas",
            description: "asdasdsdasdsdsdasdadasasd",
            harga: "200.000",
            stock: 50,
            rating: 4.5,
            kategori: "aksesoris",
            kondisi: "baru",
          };

          dataKirim.append("file_upload", input.files[0]);
          dataKirim.append("id_produk", dataProduk.id);
          dataKirim.append("name_produk", dataProduk.name_produk);
          dataKirim.append("description", dataProduk.description);
          dataKirim.append("harga", dataProduk.harga);
          dataKirim.append("stock", dataProduk.stock);
          dataKirim.append("rating", dataProduk.rating);
          dataKirim.append("kategori", dataProduk.kategori);
          dataKirim.append("kondisi", dataProduk.kondisi);
          try {
            const response = await fetch(
              "http://localhost:3000/produk/produk/upload",
              {
                method: "POST",
                // headers: { "Content-Type": "application/json" },
                body: dataKirim, // JANGAN set header Content-Type secara manual
              },
            );

            console.log(await response.json());
          } catch (error) {
            console.error("Gagal mengirim file:", error);
          }
        });
      }

      postData();

      async function getData() {
        // alert(1);
        const response = await fetch(
          "http://localhost:3000/produk/produk/list",
          {
            headers: {
              authorization:
                "bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VySWQiOiJkN2ZmMWY0MS04MmU4LTQxNTMtOGYzNi1jYmI2NTc0YTJiODciLCJpYXQiOjE3Njg2NTkyMDUsImV4cCI6MTc2OTI2NDAwNX0.F3nQxCm6Xi37mMKIiZep_MCbD1TICFTUbjfRm_TMWdk",
            },
          },
        );

        const dataProduk = await response.json();

        Object.entries(
          dataProduk.produk.map((items) => {
            const pathImage = JSON.parse(items.produks_order);
            console.log(pathImage);

            const templateEnggine = `<div>
              <img src=${`http://localhost:3000/uploads/${pathImage.pathFileImage}`}>
                <p>${items.produk_id}</p>
                <p>${items.name_produk}</p>
              </div>`;

            // append to priview
            priview.innerHTML = templateEnggine;
          }),
        );
      }
    </script>
  </body>
</html>
